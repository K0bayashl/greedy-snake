# 贪吃蛇游戏功能说明

## 目录

- [基础功能](#基础功能)
- [进阶功能](#进阶功能)
- [游戏道具](#游戏道具)
- [特殊功能](#特殊功能)
- [技术实现](#技术实现)

---

## 基础功能

### 1. 核心游戏机制

- **蛇的移动**：使用方向键控制蛇的移动方向
- **食物系统**：蛇吃到食物后身体变长，分数增加
- **碰撞检测**：
  - 撞墙：游戏结束
  - 撞到自己：游戏结束

### 2. 卡通外观系统

#### 视觉设计

贪吃蛇采用搞怪滑稽的卡通风格，增强游戏的趣味性和视觉吸引力。

##### 蛇身样式

- **形状**：从方块改为圆形，更加圆润可爱
- **颜色**：使用渐变色（#4CAF50 到 #2E7D32），营造立体感
- **高光效果**：左上角添加白色高光，增强 3D 质感
- **阴影效果**：右下角添加深色阴影，增加深度

##### 蛇头表情

蛇头根据移动方向显示不同的搞怪表情，增强互动性和趣味性：

| 方向 | 眼睛 | 嘴巴 | 特点 |
|------|------|------|------|
| **向上** | 向上看（小圆点在上半部分） | "O"型（惊讶表情） | 眼睛向上看，嘴巴呈惊讶状 |
| **向下** | 向下看（小圆点在下半部分） | 大张嘴 + 红色舌头 | 眼睛向下看，大张嘴带红色舌头 |
| **向左** | 向左看（小圆点偏左） | 歪嘴笑（向左歪） | 眼睛向左看，嘴角向左歪 |
| **向右** | 向右看（小圆点偏右） | 歪嘴笑（向右歪） | 眼睛向右看，嘴角向右歪 |

#### 技术实现

```javascript
// 新增的绘制函数
- drawSnakeBody(x, y, size)      // 绘制圆形渐变蛇身
- drawSnakeHead(x, y, size, direction)  // 绘制带表情的蛇头
- drawUpFace(x, y, size)         // 向上的表情
- drawDownFace(x, y, size)       // 向下的表情
- drawLeftFace(x, y, size)       // 向左的表情
- drawRightFace(x, y, size)      // 向右的表情
```

#### 向后兼容

- 无敌光晕效果完整保留
- 所有游戏机制不受影响
- 与双倍分数食物、无敌道具等系统完全兼容

### 3. 得分系统

- **普通食物**：每次吃到获得 10 分
- **最高分记录**：使用 LocalStorage 持久化存储
- **实时显示**：分数实时更新显示

---

## 进阶功能

### 1. 游戏控制

#### 暂停/继续
- 点击"暂停"按钮暂停游戏
- 再次点击"继续"按钮恢复游戏
- 暂停时游戏时间和所有定时器都会停止

#### 重新开始
- 点击"重新开始"按钮重置游戏
- 蛇回到初始位置
- 分数清零
- 所有特殊状态重置

### 2. 游戏时长统计

- 记录从开始到结束的游戏时间
- 游戏结束时显示用时（分+秒格式）
- 帮助玩家了解自己的游戏表现

### 3. 难度选择

#### 三种难度等级

| 难度 | 速度 | 说明 |
|------|------|------|
| 简单 | 300ms/帧 | 适合新手，速度较慢 |
| 普通 | 200ms/帧 | 标准游戏体验 |
| 困难 | 120ms/帧 | 高难度挑战，速度很快 |

#### 选择时机
- 仅在游戏未开始时可切换难度
- 游戏中难度锁定
- 游戏结束后可重新选择

---

## 游戏道具

### 双倍分数食物（金色食物）

#### 功能特点

- **外观**：金色圆形食物，带有光晕和"2x"标识
- **得分**：吃到获得 20 分（普通食物的 2 倍）
- **动画效果**：
  - 呼吸闪烁效果（透明度 0.6-1.0 变化）
  - 外圈金色光晕
  - 内圈高光效果

#### 生成机制

- **触发概率**：30%（每次生成普通食物时）
- **生成时机**：普通食物生成时有机会同时生成
- **位置规则**：
  - 不与普通食物重叠
  - 不与蛇身重叠
  - 随机分布在游戏区域内

#### 生命周期

- **存在时间**：6 秒
- **超时处理**：6 秒后自动消失
- **重生机制**：
  - 消失后 2-5 秒随机延迟后重生
  - 游戏进行中才会重生
  - 暂停时不影响计时

#### 暂停兼容

- 暂停时记录当前时间戳
- 继续时补偿暂停时间
- 确保玩家不会因为暂停而损失双倍食物

---

### 无敌道具（蓝色星星）

#### 功能特点

- **外观**：蓝色星星图标（⭐），带有发光效果
- **无敌时长**：5 秒
- **得分**：吃到获得 10 分（与普通食物相同）

#### 无敌效果

- **穿墙功能**：蛇从一边出去会从另一边出现
- **避障功能**：碰到障碍物不会死亡
- **视觉特效**：
  - 蛇身周围金色光晕（rgba(255, 215, 0, 0.4)）
  - 屏幕显示剩余时间倒计时
- **倒计时显示**：实时显示无敌剩余秒数

#### 生成机制

- **触发概率**：8%（每次生成普通食物时）
- **生成时机**：普通食物生成时有机会同时生成
- **位置规则**：
  - 不与普通食物重叠
  - 不与双倍食物重叠
  - 不与蛇身重叠
  - 随机分布在游戏区域内

#### 生命周期

- **存在时间**：永久（直到被吃掉）
- **重生机制**：
  - 被吃掉后 3-7 秒随机延迟后重生
  - 游戏进行中才会重生
  - 暂停时不影响计时

#### 穿墙逻辑

```javascript
// X 轴穿墙
if (head.x < 0) head.x = tileCountX - 1
if (head.x >= tileCountX) head.x = 0

// Y 轴穿墙
if (head.y < 0) head.y = tileCountY - 1
if (head.y >= tileCountY) head.y = 0
```

#### 碰撞检测

无敌期间跳过以下碰撞检测：
- 墙壁碰撞检测（启用穿墙）
- 障碍物碰撞检测（完全免疫）

注意：仍然会检测自身碰撞

#### 暂停兼容

- 暂停时记录当前时间戳
- 继续时补偿暂停时间
- 确保玩家获得完整的 5 秒无敌时间

#### 向后兼容

- 不与双倍分数食物冲突
- 可以同时存在两种道具
- 可以同时处于双倍分数和无敌状态

---

## 特殊功能

### 动态障碍物系统

#### 功能特点

- **外观**：深灰色砖块纹理（#5D4037），带 3D 高光和阴影效果
- **碰撞**：撞到障碍物游戏结束
- **动态刷新**：障碍物会定期刷新位置
- **警告动画**：刷新前 3 秒开始闪烁提醒

#### 难度配置

| 难度 | 障碍物数量 | 生成延迟 | 刷新间隔 |
|------|-----------|----------|----------|
| 简单 | 3 个 | 3 秒 | 15 秒 |
| 普通 | 5 个 | 2 秒 | 12 秒 |
| 困难 | 8 个 | 1 秒 | 10 秒 |

#### 生成规则

- **安全区保护**：蛇头周围 3x3 区域不生成障碍物
- **避开蛇身**：障碍物不会生成在蛇身上
- **避开食物**：障碍物不会生成在食物位置
- **分布均匀**：障碍物尽量分散在游戏区域

#### 刷新机制

- **定时刷新**：按照配置的间隔定期刷新障碍物位置
- **闪烁警告**：刷新前 3 秒开始闪烁（透明度 0.5-1.0 变化）
- **刷新保护**：刷新时重新生成位置，保持安全区规则
- **暂停兼容**：暂停/恢复时进行时间补偿

#### 技术实现

```javascript
// 状态变量
let obstacles = [];                    // 障碍物数组
let obstacleBlinking = false;         // 是否闪烁中
let obstacleRefreshTimer = null;      // 刷新定时器
let obstacleBlinkTimer = null;        // 闪烁定时器
let obstaclePauseTime = 0;            // 暂停时间戳

// 配置常量
const OBSTACLE_CONFIG = {
  easy: { count: 3, delay: 3000, refresh: 15000 },
  normal: { count: 5, delay: 2000, refresh: 12000 },
  hard: { count: 8, delay: 1000, refresh: 10000 }
};
```

#### 核心函数

- `generateObstacles()` - 生成障碍物
- `refreshObstacles()` - 刷新障碍物位置
- `drawObstacles()` - 绘制障碍物
- `checkObstacleCollision()` - 检测碰撞
- `isInSafeZone()` - 判断是否在安全区

---

## 技术实现

### 核心技术栈

- **HTML5**：页面结构
- **CSS3**：样式设计
- **JavaScript (ES6+)**：游戏逻辑
- **Canvas API**：图形绘制

### 关键实现细节

#### 1. 双倍食物状态管理

```javascript
// 状态变量
let bonusFood = null;              // 双倍食物对象
let bonusFoodCheckInterval = null; // 超时检查定时器
let bonusFoodRespawnTimeout = null; // 重生延迟定时器
let bonusFoodPauseTime = 0;        // 暂停时间戳
```

#### 2. 配置常量

```javascript
const BONUS_FOOD_DURATION = 6000;        // 存在时间（毫秒）
const BONUS_FOOD_SCORE = 20;             // 得分
const BONUS_FOOD_SPAWN_CHANCE = 0.3;     // 生成概率
const BONUS_FOOD_RESPAWN_MIN_DELAY = 2000;  // 最小重生延迟
const BONUS_FOOD_RESPAWN_MAX_DELAY = 5000;  // 最大重生延迟
```

#### 3. 绘制算法

- 使用 `Math.sin()` 函数创建平滑的呼吸效果
- 使用 `rgba()` 颜色模式实现透明度变化
- 分层绘制：光晕 → 主体 → 高光 → 文字

#### 4. 无敌道具实现

```javascript
// 状态变量
let invincibleItem = null           // 无敌道具对象
let isInvincible = false            // 是否无敌状态
let invincibleEndTime = 0           // 无敌结束时间
let invinciblePauseTime = 0         // 暂停时间戳

// 配置常量
const INVINCIBLE_DURATION = 5000            // 无敌时长（毫秒）
const INVINCIBLE_SCORE = 10                 // 得分
const INVINCIBLE_SPAWN_CHANCE = 0.08        // 生成概率
const INVINCIBLE_RESPAWN_MIN_DELAY = 3000   // 最小重生延迟
const INVINCIBLE_RESPAWN_MAX_DELAY = 7000   // 最大重生延迟
```

**核心功能**：
- 穿墙逻辑：坐标超出边界时从另一侧出现
- 视觉效果：蛇身金色光晕 + 倒计时显示
- 时间管理：暂停时补偿，确保准确 5 秒
- 向后兼容：不与其他道具冲突

#### 5. 定时器管理

- **生成检查**：每次生成普通食物时
- **超时检查**：每 500ms 检查一次
- **重生延迟**：使用 `setTimeout` 实现随机延迟
- **暂停处理**：清除所有定时器，记录时间戳

### 数据持久化

使用 `localStorage` 存储最高分：

```javascript
// 读取
highScore = localStorage.getItem('snakeHighScore') || 0;

// 保存
localStorage.setItem('snakeHighScore', highScore);
```

---

## 功能优先级

### 已实现 ✅

- [x] 基础游戏逻辑
- [x] 得分系统
- [x] 最高分记录
- [x] 游戏时长统计
- [x] 暂停/继续
- [x] 重新开始
- [x] 难度选择
- [x] 双倍分数食物
- [x] 动态障碍物系统
- [x] 无敌道具
- [x] 卡通外观系统

### 未来可扩展 💡

- [ ] 更多道具类型（减速、穿墙、磁铁等）
- [ ] 更多皮肤主题（不同风格的蛇）
- [ ] 音效和背景音乐
- [ ] 排行榜功能
- [ ] 移动端适配
- [ ] 多人对战模式

---

## 更新日志

### v1.6 (2026-01-23)

**新增**：卡通外观系统
- 蛇身从方块改为圆形，带渐变色和高光效果
- 蛇头根据移动方向显示搞怪滑稽表情
  - 向上：眼睛向上看，嘴巴"O"型
  - 向下：眼睛向下看，大张嘴带红色舌头
  - 向左：眼睛向左看，歪嘴笑
  - 向右：眼睛向右看，歪嘴笑
- 新增函数：drawSnakeBody(), drawSnakeHead(), drawUpFace(), drawDownFace(), drawLeftFace(), drawRightFace()
- 保持向后兼容：无敌光晕效果完整保留

### v1.5 (2026-01-23)

**新增**：无敌道具系统
- 蓝色星星图标（⭐），8% 概率生成
- 吃到后获得 5 秒无敌状态
- 无敌效果：穿墙 + 避障 + 金色光晕
- 倒计时显示剩余时间
- 被吃掉后 3-7 秒随机重生
- 暂停时时间补偿，确保准确 5 秒

### v1.4 (2026-01-23)

**新增**：动态障碍物系统
- 游戏过程中定期刷新障碍物位置
- 简单难度：3个障碍物，3秒后生成，15秒刷新
- 普通难度：5个障碍物，2秒后生成，12秒刷新
- 困难难度：8个障碍物，1秒后生成，10秒刷新
- 刷新前3秒闪烁警告
- 蛇头周围3x3安全区保护

### v1.3 (2026-01-22)

**新增**：双倍分数食物系统
- 30% 概率生成金色双倍食物
- 限时 6 秒，带闪烁动画
- 吃到获得 20 分（普通食物 2 倍）
- 超时后 2-5 秒随机重生

### v1.2 (2026-01-22)

**新增**：难度选择功能
- 简单、普通、困难三种模式
- 不同速度等级

### v1.1 (2026-01-22)

**新增**：游戏时长统计
- 记录并显示游戏时间

### v1.0 (2026-01-22)

**初始版本**：
- 基础游戏逻辑
- 得分和最高分系统
- 暂停/继续功能

---

## 文件清单

```
greedy-snake/
├── index.html         # 游戏主页面
├── style.css          # 样式文件
├── game.js            # 游戏逻辑
├── learning.md        # Claude Code 学习笔记
├── features.md        # 功能说明文档（本文件）
├── hooks-guide.md     # Hooks 使用指南
├── subagent-guide.md  # SubAgent 使用指南
└── .claude/
    ├── settings.json  # Claude Code 配置
    └── agents/        # 自定义 Agent 定义
        ├── developer.md
        ├── reviewer.md
        ├── designer.md
        ├── tester.md
        └── doc-writer.md
```

---

## 快速开始

### 运行游戏

```bash
# Windows
start index.html

# 或直接用浏览器打开
# C:\workspace4idea\greedy-snake\greedy-snake\index.html
```

### 操作说明

- **方向键**：控制蛇的移动方向
- **开始按钮**：开始游戏
- **暂停按钮**：暂停/继续游戏
- **重新开始按钮**：重置游戏
- **难度按钮**：选择难度（仅游戏未开始时）

---

**文档版本**：v1.3
**最后更新**：2026-01-23
**维护者**：doc-writer Agent
