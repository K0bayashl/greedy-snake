# 难度系统功能更新说明

## 更新时间
2026-01-26

## 功能概述
添加护栏和障碍物循序渐进难度系统，实现隐性连续难度递增。

---

## 核心变更

### 1. 难度系数公式
```javascript
function getDifficultyMultiplier(distance) {
  const baseMultiplier = 1 + (distance / 5000) * 0.5
  return Math.min(baseMultiplier, 2.5)
}
```

- 难度系数随距离线性增长
- 每 1000m 增加 0.1
- 上限限制为 2.5（在 15000m 时达到）

### 2. 加法运算调整
- **下限**: 从 10% 微调至 15%（使用 Math.min 限制上限）
- **上限**: 从 50% 递增到 80%

```javascript
add: {
  minPercent: Math.min(0.15, 0.1 + (multiplier - 1) * 0.025),
  maxPercent: Math.min(0.8, 0.5 + (multiplier - 1) * 0.3)
}
```

### 3. 减法运算调整
- **上限**: 从 30% 提高到 50%

```javascript
sub: {
  maxPercent: Math.min(0.5, 0.3 + (multiplier - 1) * 0.2)
}
```

### 4. 乘法运算扩展
- **初始**: [2, 3]
- **中期**: [2, 3, 4]（难度系数 > 1.3）
- **后期**: [2, 3, 4, 5]（难度系数 > 1.9）

```javascript
mul: {
  multipliers: multiplier > 1.9 ? [2, 3, 4, 5] : (multiplier > 1.3 ? [2, 3, 4] : [2, 3])
}
```

### 5. 除法运算扩展
- **初始**: [2, 3, 4, 5]
- **中期**: [2, 3, 4, 5, 6]（难度系数 > 1.5）
- **后期**: [2, 3, 4, 5, 6, 7]（难度系数 > 2.1）

```javascript
div: {
  divisors: multiplier > 2.1 ? [2, 3, 4, 5, 6, 7] : (multiplier > 1.5 ? [2, 3, 4, 5, 6] : [2, 3, 4, 5])
}
```

### 6. 障碍物数值调整
- **下限**: 从 30% 提高到 50%
- **上限**: 从 80% 提高到 85%

```javascript
obstacle: {
  minPercent: Math.min(0.5, 0.3 + (multiplier - 1) * 0.1),
  maxPercent: Math.min(0.85, 0.8 + (multiplier - 1) * 0.025)
}
```

---

## 代码变更要点

### 新增函数
1. **getDifficultyMultiplier(distance)** - 计算难度系数
2. **getAdjustedConfig(distance)** - 返回动态调整后的配置

### 修改函数
1. **getOperationValueByType(opType, currentNumber, distance)** - 添加 distance 参数
2. **spawnObject(y, distance)** - 使用 getAdjustedConfig 获取动态配置
3. **preSpawnObjects()** - 使用 getAdjustedConfig 获取动态配置

---

## 难度变化表

| 距离 | 难度系数 | 加法范围 | 减法上限 | 乘法选项 | 除法选项 | 障碍物范围 |
|------|---------|----------|----------|----------|----------|------------|
| 0m | 1.0 | 10%-50% | 30% | [2,3] | [2,3,4,5] | 30%-80% |
| 1000m | 1.1 | 10%-53% | 32% | [2,3] | [2,3,4,5] | 31%-80% |
| 2500m | 1.25 | 11%-58% | 35% | [2,3] | [2,3,4,5] | 33%-81% |
| 3000m | 1.3 | 11%-59% | 36% | [2,3] | [2,3,4,5] | 33%-81% |
| 5000m | 1.5 | 11%-65% | 40% | [2,3,4] | [2,3,4,5,6] | 35%-83% |
| 9000m | 1.9 | 12%-77% | 48% | [2,3,4] | [2,3,4,5,6] | 39%-85% |
| 10000m | 2.0 | 13%-80% | 50% | [2,3,4,5] | [2,3,4,5,6,7] | 40%-85% |
| 15000m+ | 2.5 | 14%-80% | 50% | [2,3,4,5] | [2,3,4,5,6,7] | 45%-85% |

---

## 测试结果

### 功能测试
- 游戏基本功能正常运行
- 难度系数计算正确
- 数值范围验证通过
- 边界情况处理正确

### 体验测试
- 难度曲线循序渐进
- 早期游戏适合新手学习
- 中期游戏需要策略思考
- 后期游戏需要高度专注

---

## 设计说明

### 隐性难度系统
玩家不会看到显式的难度等级，难度变化通过运算复杂度和数值范围自然体现。

### 连续递增
难度系数随距离连续增长，大部分参数平滑过渡，给玩家充分的适应时间。

### 阶段扩展
乘除法运算使用阶段性扩展（在特定距离点增加新选项），这是一种有意设计，让玩家在适当时机接触新难度。
