# 贪吃蛇游戏功能说明

## 目录

- [基础功能](#基础功能)
- [进阶功能](#进阶功能)
- [特殊功能](#特殊功能)
- [技术实现](#技术实现)

---

## 基础功能

### 1. 核心游戏机制

- **蛇的移动**：使用方向键控制蛇的移动方向
- **食物系统**：蛇吃到食物后身体变长，分数增加
- **碰撞检测**：
  - 撞墙：游戏结束
  - 撞到自己：游戏结束

### 2. 得分系统

- **普通食物**：每次吃到获得 10 分
- **最高分记录**：使用 LocalStorage 持久化存储
- **实时显示**：分数实时更新显示

---

## 进阶功能

### 1. 游戏控制

#### 暂停/继续
- 点击"暂停"按钮暂停游戏
- 再次点击"继续"按钮恢复游戏
- 暂停时游戏时间和所有定时器都会停止

#### 重新开始
- 点击"重新开始"按钮重置游戏
- 蛇回到初始位置
- 分数清零
- 所有特殊状态重置

### 2. 游戏时长统计

- 记录从开始到结束的游戏时间
- 游戏结束时显示用时（分+秒格式）
- 帮助玩家了解自己的游戏表现

### 3. 难度选择

#### 三种难度等级

| 难度 | 速度 | 说明 |
|------|------|------|
| 简单 | 300ms/帧 | 适合新手，速度较慢 |
| 普通 | 200ms/帧 | 标准游戏体验 |
| 困难 | 120ms/帧 | 高难度挑战，速度很快 |

#### 选择时机
- 仅在游戏未开始时可切换难度
- 游戏中难度锁定
- 游戏结束后可重新选择

---

## 特殊功能

### 双倍分数食物（金色食物）

#### 功能特点

- **外观**：金色圆形食物，带有光晕和"2x"标识
- **得分**：吃到获得 20 分（普通食物的 2 倍）
- **动画效果**：
  - 呼吸闪烁效果（透明度 0.6-1.0 变化）
  - 外圈金色光晕
  - 内圈高光效果

#### 生成机制

- **触发概率**：30%（每次生成普通食物时）
- **生成时机**：普通食物生成时有机会同时生成
- **位置规则**：
  - 不与普通食物重叠
  - 不与蛇身重叠
  - 随机分布在游戏区域内

#### 生命周期

- **存在时间**：6 秒
- **超时处理**：6 秒后自动消失
- **重生机制**：
  - 消失后 2-5 秒随机延迟后重生
  - 游戏进行中才会重生
  - 暂停时不影响计时

#### 暂停兼容

- 暂停时记录当前时间戳
- 继续时补偿暂停时间
- 确保玩家不会因为暂停而损失双倍食物

---

## 技术实现

### 核心技术栈

- **HTML5**：页面结构
- **CSS3**：样式设计
- **JavaScript (ES6+)**：游戏逻辑
- **Canvas API**：图形绘制

### 关键实现细节

#### 1. 双倍食物状态管理

```javascript
// 状态变量
let bonusFood = null;              // 双倍食物对象
let bonusFoodCheckInterval = null; // 超时检查定时器
let bonusFoodRespawnTimeout = null; // 重生延迟定时器
let bonusFoodPauseTime = 0;        // 暂停时间戳
```

#### 2. 配置常量

```javascript
const BONUS_FOOD_DURATION = 6000;        // 存在时间（毫秒）
const BONUS_FOOD_SCORE = 20;             // 得分
const BONUS_FOOD_SPAWN_CHANCE = 0.3;     // 生成概率
const BONUS_FOOD_RESPAWN_MIN_DELAY = 2000;  // 最小重生延迟
const BONUS_FOOD_RESPAWN_MAX_DELAY = 5000;  // 最大重生延迟
```

#### 3. 绘制算法

- 使用 `Math.sin()` 函数创建平滑的呼吸效果
- 使用 `rgba()` 颜色模式实现透明度变化
- 分层绘制：光晕 → 主体 → 高光 → 文字

#### 4. 定时器管理

- **生成检查**：每次生成普通食物时
- **超时检查**：每 500ms 检查一次
- **重生延迟**：使用 `setTimeout` 实现随机延迟
- **暂停处理**：清除所有定时器，记录时间戳

### 数据持久化

使用 `localStorage` 存储最高分：

```javascript
// 读取
highScore = localStorage.getItem('snakeHighScore') || 0;

// 保存
localStorage.setItem('snakeHighScore', highScore);
```

---

## 功能优先级

### 已实现 ✅

- [x] 基础游戏逻辑
- [x] 得分系统
- [x] 最高分记录
- [x] 游戏时长统计
- [x] 暂停/继续
- [x] 重新开始
- [x] 难度选择
- [x] 双倍分数食物

### 未来可扩展 💡

- [ ] 障碍物系统
- [ ] 多种道具效果
- [ ] 皮肤主题切换
- [ ] 音效和背景音乐
- [ ] 排行榜功能
- [ ] 移动端适配
- [ ] 多人对战模式

---

## 更新日志

### v1.3 (2026-01-22)

**新增**：双倍分数食物系统
- 30% 概率生成金色双倍食物
- 限时 6 秒，带闪烁动画
- 吃到获得 20 分（普通食物 2 倍）
- 超时后 2-5 秒随机重生

### v1.2 (2026-01-22)

**新增**：难度选择功能
- 简单、普通、困难三种模式
- 不同速度等级

### v1.1 (2026-01-22)

**新增**：游戏时长统计
- 记录并显示游戏时间

### v1.0 (2026-01-22)

**初始版本**：
- 基础游戏逻辑
- 得分和最高分系统
- 暂停/继续功能

---

## 文件清单

```
greedy-snake/
├── index.html         # 游戏主页面
├── style.css          # 样式文件
├── game.js            # 游戏逻辑
├── learning.md        # Claude Code 学习笔记
├── features.md        # 功能说明文档（本文件）
├── hooks-guide.md     # Hooks 使用指南
├── subagent-guide.md  # SubAgent 使用指南
└── .claude/
    ├── settings.json  # Claude Code 配置
    └── agents/        # 自定义 Agent 定义
        ├── developer.md
        ├── reviewer.md
        ├── designer.md
        ├── tester.md
        └── doc-writer.md
```

---

## 快速开始

### 运行游戏

```bash
# Windows
start index.html

# 或直接用浏览器打开
# C:\workspace4idea\greedy-snake\greedy-snake\index.html
```

### 操作说明

- **方向键**：控制蛇的移动方向
- **开始按钮**：开始游戏
- **暂停按钮**：暂停/继续游戏
- **重新开始按钮**：重置游戏
- **难度按钮**：选择难度（仅游戏未开始时）

---

**文档版本**：v1.0
**最后更新**：2026-01-22
**维护者**：doc-writer Agent
