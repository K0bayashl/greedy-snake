---
name: update-feature
description: 更新现有功能 - 完整开发闭环（设计-开发-审查-测试-文档）
user-invocable: true
context: current
model: sonnet
allowed-tools:
  - Read
  - Write
  - Task
  - AskUserQuestion
  - TodoWrite
---

# 更新现有功能技能 - 完整开发闭环

你是一位负责更新现有功能的专家，自动执行完整的开发流程。

## 执行流程

### 阶段1：需求确认

如果用户只给出功能名称或简单描述（如"障碍物要加警告"），先追问需求细节：

**必问问题**：
1. 要更新哪个功能？
2. 具体要修改什么？（新增/删除/改进）
3. 为什么要这样修改？（解决什么问题）
4. 是否涉及 UI 变更？

### 阶段2：设计评审

**⚠️ 必须先调用 designer SubAgent**：

```
Task(
  subagent_type="designer",
  prompt="设计功能更新：{功能名称}\n需求：{用户需求}\n当前实现：{代码现状}\n\n请设计：\n1. 修改方案（最小化影响范围）\n2. 数据结构变更\n3. 向后兼容性\n4. 潜在风险\n5. 测试要点"
)
```

### 阶段3：方案评估

**整理设计方案给用户确认**，包含：
- 当前实现说明
- 修改方案概述
- 影响范围分析
- 潜在风险
- 需要确认的问题

**等待用户确认后继续**。

### 阶段4：代码实现

**调用 developer SubAgent**：

```
Task(
  subagent_type="developer",
  prompt="更新功能：{功能名称}\n\n设计方案：\n{设计摘要}\n\n实现要求：\n1. 先 Read 相关文件了解当前实现\n2. 使用 TodoWrite 创建任务清单\n3. 按清单逐步修改代码\n4. 保持向后兼容\n5. 遵循项目代码规范"
)
```

### 阶段5：代码审查

**⚠️ 开发完成后必须调用 reviewer SubAgent**：

```
Task(
  subagent_type="reviewer",
  prompt="审查功能更新：{功能名称}\n\n变更文件：\n{文件列表}\n\n审查要点：\n1. 是否破坏原有功能\n2. 向后兼容性\n3. 代码质量\n4. 潜在 Bug\n5. 性能影响"
)
```

### 阶段6：测试验证

**调用 tester SubAgent**：

```
Task(
  subagent_type="tester",
  prompt="测试功能更新：{功能名称}\n\n更新说明：{更新说明}\n\n测试要求：\n1. 原有功能是否正常\n2. 新增/修改功能是否工作\n3. 边界情况测试\n4. 回归测试\n5. 输出测试报告"
)
```

### 阶段7：文档更新

**调用 doc-writer SubAgent**：

```
Task(
  subagent_type="doc-writer",
  prompt="更新功能文档：{功能名称}\n\n更新说明：{更新说明}\n变更要点：{变更要点}\n\n更新以下文档：\n1. docs/learning.md - 更新功能说明\n2. docs/features.md - 更新功能详情\n3. 添加版本更新日志"
)
```

### 阶段8：完成报告

**向用户输出完成报告**：

```
## 功能更新完成

### 功能：{功能名称}
### 更新类型：{新增/改进/修复}

### 开发流程
- ✅ 设计评审（designer）
- ✅ 代码实现（developer）
- ✅ 代码审查（reviewer）
- ✅ 功能测试（tester）
- ✅ 文档更新（doc-writer）

### 变更文件
| 文件 | 变更类型 | 变更说明 |
|------|----------|----------|
| ... | 修改/新增 | ... |

### 测试结果
{测试摘要}

### 向后兼容性
{兼容性说明}

### 建议后续操作
1. 运行游戏验证更新
2. 测试原有功能是否正常
3. 如有问题请反馈
```

## SubAgent 调用规范

| SubAgent | 用途 | 调用时机 |
|----------|------|----------|
| `designer` | 设计修改方案 | 需求确认后，第一位调用 |
| `developer` | 代码修改 | 设计方案确认后 |
| `reviewer` | 代码审查 | 代码修改完成后，必须调用 |
| `tester` | 功能测试（含回归） | 代码审查通过后 |
| `doc-writer` | 文档更新 | 测试通过后 |

## 自动化规则

**必须执行的调用**：
1. designer → 需求确认后
2. developer → 设计确认后
3. reviewer → 开发完成后
4. tester → 审查通过后
5. doc-writer → 测试通过后

**跳过条件**：
- 只有用户明确要求跳过某个阶段时才可跳过
- 跳过前必须告知用户风险

## 输出格式

每个阶段完成后向用户报告进度：

```
---
### 阶段完成：{阶段名称}

{结果摘要}

---
### 下一步：{下一阶段}
```

## 功能更新类型

| 类型 | 说明 | 示例 |
|------|------|------|
| **新增** | 在现有功能上增加新特性 | 障碍物加警告提示 |
| **改进** | 优化现有实现 | 优化刷新算法 |
| **修复** | 修复 Bug | 修复暂停计时问题 |
| **重构** | 改进代码结构 | 提取公共函数 |

## 设计评估要点

| 检查项 | 说明 |
|--------|------|
| 必要性 | 更新是否真正需要 |
| 影响范围 | 是否影响其他功能 |
| 兼容性 | 是否保持向后兼容 |
| 可维护性 | 代码是否易维护 |
| 测试覆盖 | 是否需要回归测试 |

## 禁止行为

- ❌ 跳过设计评审直接改代码
- ❌ 跳过代码审查直接测试
- ❌ 跳过回归测试直接更新文档
- ❌ 忽略 reviewer 发现的问题
- ❌ 破坏原有功能
- ❌ 用户未确认方案就实现